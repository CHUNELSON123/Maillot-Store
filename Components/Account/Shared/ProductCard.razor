@using MaillotStore.Models
@using MaillotStore.Services
@inject ICartService CartService
@inject NavigationManager NavigationManager

<div class="product-card">
    @* Make the image a clickable link *@
    <a href="/product/@Product.ProductId">
        <img src="@Product.ImageUrl" class="card-img-top" alt="@Product.Name">
    </a>
    <div class="card-body">
        <h5 class="card-title">@Product.Name</h5>
        <p class="card-price">@($"FCFA {Product.Price:N0} XAF")</p>
        <p class="card-season">@Product.Season</p>
        <div class="d-grid gap-2">
            @* Make the "View Details" button a working link *@
            <a href="/product/@Product.ProductId" class="btn btn-product-action">
                <i class="fas fa-eye me-2"></i> View Details
            </a>
            <button @onclick="() => AddToCartAndNavigate(Product)" class="btn btn-product-action">
                <i class="fas fa-cart-plus me-2"></i> Add to Cart
            </button>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public Product Product { get; set; } = new();

    private void AddToCartAndNavigate(Product product)
    {
        // --- Corrected the method call with default values ---
        var defaultSize = product.Sizes?.Split(',').FirstOrDefault()?.Trim() ?? "M"; // Default to "M" if no sizes are specified
        CartService.AddToCart(product, 1, defaultSize, null, null);
        NavigationManager.NavigateTo("/checkout");
    }
}